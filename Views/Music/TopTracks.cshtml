@model List<Mazzika.Models.TopTrack>

@{
    ViewData["Title"] = "Top Tracks";
}

<h1>Top Tracks</h1>

@if (Model != null && Model.Any())
{
    <table class="table">
        <thead>
            <tr>
                <th>Title</th>
                <th>Play Count</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var track in Model)
            {
                <tr>
                    <td>@track.Title</td>
                    <td>@track.PlayCount</td>
                    <td>
                        <button class="btn btn-primary" onclick="playVideo('@track.VideoId', '@track.Title', '@track.Description', '@track.ThumbnailUrl', '@track.PublishedAt', '@track.ChannelTitle')">Play</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>No tracks available.</p>
}

<script>
    function playVideo(videoId, title, description, thumbnailUrl, publishedAt, channelTitle) {
        // Logic to play the video
        alert('Playing video with ID: ' + videoId);

        // Notify the server to add the video to top tracks
        const video = {
            id: videoId,
            title: title,
            description: description,
            thumbnailUrl: thumbnailUrl,
            publishedAt: publishedAt,
            channelTitle: channelTitle
        };

        fetch('/Music/AddToTopTracks', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(video)
        }).then(response => {
            if (response.ok) {
                console.log('Video added to top tracks.');
            } else {
                console.error('Failed to add video to top tracks.');
            }
        }).catch(error => {
            console.error('Error adding video to top tracks:', error);
        });
    }

    function refreshTopTracks() {
        fetch('/Music/TopTracks')
            .then(response => response.text())
            .then(html => {
                document.body.innerHTML = html;
            })
            .catch(error => console.error('Error refreshing top tracks:', error));
    }
</script>